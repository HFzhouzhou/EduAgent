# 🎯 高级功能：智能Word模板填充

## 📖 功能介绍

这是一个高级功能，允许用户自定义Word模板格式，然后通过XML标签（Jinja2语法）将AI生成的教案内容自动填充到模板的指定位置。

### ✨ 功能特点

- 🎨 **完全自定义**：用户可以自由设计模板样式和布局
- 🏷️ **智能标签**：使用 `{{标签名}}` 语法标记填充位置
- 🔄 **批量生成**：一个模板可以生成多个教案
- 📋 **格式保留**：保持模板的所有格式（字体、颜色、对齐等）
- 🎯 **精确控制**：每个字段都可以单独控制显示位置

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install docxtpl>=0.16.7
```

### 2. 运行演示

```bash
python demo_template_filler.py
```

这将：
- ✅ 创建一个示例模板
- ✅ 显示标签使用指南
- ✅ 生成一个完整的教案示例

## 📝 支持的标签

### 基本信息标签

| 标签 | 说明 | 示例 |
|------|------|------|
| `{{course_name}}` | 课程名称 | 数据结构 |
| `{{teacher_name}}` | 授课教师 | 张老师 |
| `{{class_name}}` | 授课班级 | 计算机2021级1班 |
| `{{lesson_number}}` | 课次 | 1 |
| `{{lesson_title}}` | 课题 | 数据结构概述 |
| `{{teaching_hours}}` | 学时 | 2 |

### 教学内容标签

| 标签 | 说明 |
|------|------|
| `{{teaching_objectives}}` | 教学目标 |
| `{{teaching_focus}}` | 教学重点 |
| `{{teaching_difficulty}}` | 教学难点 |
| `{{teaching_methods}}` | 教学方法 |
| `{{teaching_process}}` | 教学过程 |
| `{{homework}}` | 课后作业 |
| `{{reflection}}` | 教学反思 |

## 🎨 使用方法

### 步骤1：创建模板

在Word中创建您的教案模板：

```
┌─────────────────────────────────────────┐
│        XX大学教案模板                    │
├──────────┬──────────┬──────────┬────────┤
│课程名称  │{{course_name}}      │教师    │{{teacher_name}}│
├──────────┼──────────┼──────────┼────────┤
│授课班级  │{{class_name}}       │课次    │第{{lesson_number}}次│
├──────────┴──────────┴──────────┴────────┤
│                                         │
│ 一、课题                                │
│ {{lesson_title}}                        │
│                                         │
│ 二、教学目标                            │
│ {{teaching_objectives}}                 │
│                                         │
│ 三、教学过程                            │
│ {{teaching_process}}                    │
│                                         │
└─────────────────────────────────────────┘
```

### 步骤2：插入标签

在Word中，在需要填充内容的位置，直接输入标签：

```
{{course_name}}
```

**注意**：
- 标签必须使用 `{{}}` 包裹
- 标签名区分大小写
- 可以在任何地方使用（表格、文本框、页眉页脚等）

### 步骤3：保存模板

保存为 `.docx` 格式（不要用 `.doc` 旧格式）

### 步骤4：使用模板

```python
from utils.template_filler import WordTemplateFiller

filler = WordTemplateFiller()

# 准备数据
lesson_data = {
    'lesson_number': '1',
    'lesson_title': '数据结构概述',
    # ... 其他字段
}

course_data = {
    'course_name': '数据结构',
    'teacher_name': '张老师',
    'class_name': '计算机2021级1班',
}

# 填充模板
filler.fill_lesson_plan(
    template_path='我的模板.docx',
    output_path='教案_第1次课.docx',
    lesson_plan=lesson_data,
    course_info=course_data
)
```

## 🔧 高级用法

### 条件显示

```jinja2
{% if homework %}
六、课后作业
{{homework}}
{% endif %}
```

只有当 `homework` 有内容时才显示这部分。

### 循环列表

```jinja2
教学目标：
{% for objective in objectives %}
• {{objective}}
{% endfor %}
```

### 表格中使用

```
┌────────┬────────────────┐
│ 课程   │ {{course_name}} │
├────────┼────────────────┤
│ 教师   │ {{teacher_name}}│
└────────┴────────────────┘
```

### 多列布局

```
┌──────────────┬──────────────┐
│ {{field_1}}  │ {{field_2}}  │
│              │              │
│ {{field_3}}  │ {{field_4}}  │
└──────────────┴──────────────┘
```

## 💡 实际应用场景

### 场景1：学校统一模板

学校提供统一的教案模板格式，教师只需：
1. 在模板中插入标签
2. 使用系统生成教案内容
3. 自动填充到统一格式

### 场景2：多种教案格式

不同课程需要不同格式：
- 理论课教案模板
- 实验课教案模板
- 实践课教案模板

只需准备多个模板，使用相同的数据即可。

### 场景3：个性化定制

每位教师有自己的习惯：
- 自定义字体和颜色
- 自定义章节标题
- 自定义表格样式

系统会保留所有格式设置。

## 📊 与普通导出的对比

| 特性 | 普通导出 | 智能模板填充 |
|------|----------|--------------|
| 格式控制 | 系统固定 | 完全自定义 |
| 学习成本 | 低 | 中（需要了解标签） |
| 灵活性 | 低 | 高 |
| 适用场景 | 快速生成 | 精确控制 |
| 批量生成 | ✅ | ✅ |
| 格式统一 | 系统统一 | 用户统一 |

## 🎯 最佳实践

### 1. 模板设计建议

✅ **推荐做法**：
- 先设计一个完整的教案样例
- 确定所有格式（字体、段落、表格等）
- 然后将内容替换为标签

❌ **避免做法**：
- 不要在标签两边加多余的空格
- 不要使用特殊字符作为标签名
- 不要在公式或图表中使用标签

### 2. 标签命名

✅ **推荐**：
```
{{course_name}}
{{teaching_objectives}}
```

❌ **不推荐**：
```
{{ course_name }}  # 多余空格
{{课程名称}}        # 中文标签
{{COURSE-NAME}}    # 连字符可能有问题
```

### 3. 测试流程

1. 创建简单的测试模板（2-3个标签）
2. 用小数据测试填充
3. 确认格式正确
4. 扩展到完整模板

## 🔍 故障排查

### 问题1：标签没有被替换

**原因**：标签名不匹配

**解决**：
```python
# 检查模板中的标签
result = filler.check_template_tags('模板.docx')
print(result['recognized_tags'])  # 查看识别的标签
```

### 问题2：格式错乱

**原因**：Word模板中有隐藏格式

**解决**：
1. 在Word中显示所有格式标记（Ctrl+Shift+8）
2. 清理多余的格式
3. 重新保存模板

### 问题3：表格中标签不工作

**原因**：表格单元格有特殊格式

**解决**：
- 确保标签在纯文本模式下输入
- 避免使用粘贴功能，手动输入标签

## 📚 完整示例

查看完整示例代码：
```bash
python demo_template_filler.py
```

生成的文件：
- `教案模板_智能标签版.docx` - 示例模板
- `教案_第1次课.docx` - 填充后的教案

## 🔗 相关资源

- [docxtpl 官方文档](https://docxtpl.readthedocs.io/)
- [Jinja2 模板语法](https://jinja.palletsprojects.com/)
- [python-docx 文档](https://python-docx.readthedocs.io/)

## 🤝 技术支持

如有问题，请查看：
1. 本文档的"故障排查"部分
2. 运行 `demo_template_filler.py` 查看示例
3. 查看 `utils/template_filler.py` 源代码

---

**提示**：这是一个高级功能，建议先熟悉基本的教案生成功能，然后再使用模板填充功能进行精确控制。

